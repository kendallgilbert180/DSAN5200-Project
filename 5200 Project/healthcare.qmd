---
title: "Healthcare Indicators"
format: html
editor: visual
---

```{r echo=FALSE}
library(tidyverse)
library(ggplot2)
library(lubridate)
library(plotly)
library(gridExtra)
library(crosstalk)
library(Ecdat)
```

```{r echo=FALSE}
hospital_beds <- read.csv("Data_cleaned/hospital_beds.csv")
hospital_beds <- hospital_beds %>%
  filter(Year=='2021') %>%
  subset(select=-X)

gdp <- read.csv("Data_Uncleaned/GDP.csv")
gdp <- gdp %>%
  subset(select=c(Time, X2021)) %>%
  rename(Country=Time, gdp=X2021)

data.p1 <- left_join(gdp, hospital_beds, by="Country")
data.p1$gdp<-as.numeric(data.p1$gdp)

```

### Healthcare Indicators: Number of Hospital Beds, Length of Hospital Stays, and GDP

```{r echo=FALSE}

p1 <- ggplot() + geom_point(data=data.p1, aes(x=Value, y=gdp),color="#57d4ff") + theme_minimal() + theme(panel.background = element_rect(fill="#faf0e6"), plot.background=element_rect(fill="#faf0e6"), plot.title = element_text(family = "PT Sans Narrow"), axis.title = element_text(family = "PT Sans Narrow"), axis.text = element_text(family = "PT Sans Narrow"))+ labs(title="GDP Compared to Number of Hospital Beds Available in 2021", x="Hospital Beds per Capita", y="GDP") 

ggplotly(p1)
```

```{r echo=FALSE}
hospital_bed2 <- read.csv("Data_cleaned/hospital_beds.csv")
gdp2 <- read.csv("Data_Uncleaned/GDP.csv")
hospital_stay <- read.csv("Data_cleaned/hospital_stay.csv")

hospital_bed2 <- hospital_bed2 %>%
  subset(select=-X)
gdp2<- gdp2 %>%
  rename(Country=Time) %>%
  pivot_longer(cols=starts_with("X"), names_to="Year.1", values_to="gdp")

gdp2$Year.1<-substr(gdp2$Year.1, 2, 5)
gdp2$key <- paste(gdp2$Country, gdp2$Year.1, sep="")
hospital_bed2$key <- paste(hospital_bed2$Country, hospital_bed2$Year, sep="")
hospital_stay$key <- paste(hospital_stay$Country, hospital_stay$Year, sep="")

data.p2 <- left_join(gdp2, hospital_bed2, by="key") %>%
  left_join(hospital_stay, by="key")


data.p2 <- data.p2 %>%
  subset(select=-c(Country.y, Year.x, key, X, Country.x, Year.y)) %>%
  filter(Year.1 %in% c('2010','2011','2012','2013','2014','2015','2016','2017','2018','2019','2020','2021','2022')) %>%
  rename(beds=Value.x, stay=Value.y)

data.p2$Year.1<-as.numeric(data.p2$Year.1)
data.p2$gdp<-as.numeric(data.p2$gdp)
data.p2$beds<-as.numeric(data.p2$beds)
data.p2$stay<-as.numeric(data.p2$stay)







```

```{r echo=FALSE}

shared_data <- SharedData$new(data.p2)

p2 <- shared_data %>%
  plot_ly(x=~gdp, y=~beds) %>%
  add_markers(color=I("#ff6f69")) %>%
  layout(plot_bgcolor="#faf0e6",
         xaxis=list(title="GDP", titlefont=list(family="PT Sans Narrow")),
         yaxis=list(title="Number of Beds", titlefont=list(family="PT Sans Narrow")))

p3 <- shared_data %>%
  plot_ly(x=~stay, y=~beds) %>%
  add_markers(color=I("#57d4ff")) %>%
  layout(plot_bgcolor="#faf0e6",
         xaxis=list(title="Stay length", titlefont=list(family="PT Sans Narrow")))


subplot(p2, p3, titleX=T, shareY=T) %>%
  hide_legend() %>%
  highlight(on='plotly_click') %>%
  layout(
    title="Beds per Capita based on Hospital Stay Length and GDP",
    titlefont=list(family="PT Sans Narrow")
  )
```

```{r echo=FALSE}

barchart1 <- data.p2 %>%
  filter(Year.1==2021) %>%
  SharedData$new(key=~Country) %>%
  plot_ly() %>%
  add_bars(y=~Country, x= ~beds, color=I("gray"), orientation='h', name="Average Beds per Capita") %>%
  layout(barmode="overlay", plot_bgcolor="#faf0e6",
        xaxis=list(title="Beds per capita", titlefont=list(family="PT Sans Narrow")),
        yaxis=list(title="Country", titlefont=list(family="PT Sans Narrow")))

scatterplot1 <- data.p2 %>%
  SharedData$new(key=~Country) %>%
  plot_ly() %>%
  add_trace(x=~Year.1, y=~beds, mode='lines', color=I("#57d4ff"), name="Hospital Stay")%>%
  layout(plot_bgcolor="#faf0e6", xaxis=list(title="Year", titlefont=list(family="PT Sans Narrow")), yaxis=list(title="Average Length of Stay", titlefont=list(family="PT Sans Narrow")))

scatterplot2 <- data.p2 %>%
  SharedData$new(key=~Country) %>%
  plot_ly() %>%
  add_trace(x=~Year.1, y=~gdp, mode='lines', color=I("#ff6f69"), name="GDP") %>%
  layout(plot_bgcolor="#faf0e6",xaxis=list(title="Year", titlefont=list(family="PT Sans Narrow")), yaxis=list(title="GDP", titlefont=list(family="PT Sans Narrow")))

subplot(barchart1, scatterplot1, scatterplot2, nrows=1, titleX=T)
          


```
